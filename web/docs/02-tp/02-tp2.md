import CommentCommitPush from '/comment-commit-push.mdx';

# TP2

üöß Les d√©tails du TP1 seront d√©voil√©s plus tard

<!--

## Consignes (20% de la note finale)
- Lisez toutes les instructions et la grille de correction avant de commencer
- Vous **DEVEZ** faire au moins les migrations et les commits demand√©s mais vous pouvez en faire plus sans probl√®me, tant que vous les documentez correctement

:::danger

Cr√©er une branche **TP2** avant de commencer √† travailler.
Faites une **sous branche** pour chacun des features sur lequel vous travaillez.

:::

## Terminez de mettre en place **i18n**
#### Ce qui est d√©j√† fait :
   - Les packages nuget sont install√©s
   - Les **vues** sont d√©j√† traduites!
   - Les **mod√®les** aussi!
   - Le Inject du **IViewLocalizer** est aussi d√©j√† pr√©sent

#### Ce qu‚Äôil faut faire :
   - Il faut configurer **i18n** dans **Program.cs**. Les fichiers de traduction **resx** se trouvent dans le r√©pertoire ** /i18n/ **
   - Il faut ajouter une fonction **SetLanguage** au **HomeController**
   - Il manque le commutateur de langue dans le **_Layout**. Utilisez une vue partielle et nommez-la **_SelectLanguage**
   - Finalement, il faut g√©rer la culture correctement en ajoutant les librairies n√©cessaires et en modifiant la vue partielle **_ValidationScriptsPartial**. (VOIR: **S√©ance 15**) (C'est pas facile de tester cette partie pour l'instant, mais une fois que vous aurez besoin de cr√©er des entr√©es avec des valeurs d√©cimales, assurez-vous que vous pouvez modifier une entre√© avec un nombre avec une d√©cimale en fran√ßais et en anglais sans probl√®me)

<CommentCommitPush/>

## Faites fonctionner le filtre

1. Impl√©mentez la fonction **Filter** du **TrainerController** pour retourner une vue Index avec le filtre comme mod√®le.
2. Impl√©menter la m√©thode **GetAllAsync** du service **TrainerService** pour prendre en compte les param√®tres de pagination de **TrainerSearchViewModelFilter**
3. Dans la m√™me m√©thode, il faut √©galement ajouter des **Where** pour filtrer selon chacun des crit√®res de recherche de **TrainerSearchViewModelFilter**
   - Pour le filtre par nom, il faut accepter un r√©sultat si le nom OU le pr√©nom contiennent la cha√Æne de charact√®res entr√©e dans le filtre
4. Pour le SelectList de certification centers, il faut obtenir le **CertificationCenter** (une simple string) de toutes les certifications et enlever les doublons, car il est possible que plusieurs certifications aient le m√™me **CertificationCenter**.

:::info

Voici comment faire une requ√™te pour une condition optionnelle dans Linq et ne filtrer que lorsque l'on s√©lectionne une valeur dans le filtre. 

:::

```csharp

.Where(x=> filter.SelectedCategoryId == null || x.CategoryId == filter.SelectedCategoryId )

```

<CommentCommitPush/>

## Affichez le d√©tail d'un **Trainer** dans la page **Trainer/Index**

1. √âcrivez du javascript en utilisant **jQuery** pour ajouter la classe **show** √† l‚Äô√©l√©ment enfant **aside** lorsqu'on survole le **card** d‚Äôun entra√Æneur.
2. √âcrivez du javascript en utilisant **jQuery** pour retirer la classe **show** √† l‚Äô√©l√©ment enfant **aside** lorsqu'on ne survole plus le **card**.

:::info

 Comme **aside** est un enfant de **card**, si l'utilisateur bouge sa souris √† l'ext√©rieur de la photo de l'entra√Æneur vers le **aside**, la souris est toujours techniquement au dessus de **card** et √ßa ne cause pas d'√©v√™nement **onmouseout**. **√áa tombe bien, c'est exactement ce que l'on veut!**

:::

![Image Reference](/tps/tp2/showDetails.png)

:::danger

 Cette vue de d√©tail (encadr√©e en rouge) est uniquement en anglais et ce n'est pas un probl√®me pour ce TP. Vous n'avez **PAS** √† la traduire.

:::

<CommentCommitPush/>

## Faire fonctionner la pagination

1. Il faut maintenant utiliser **Items** du mod√®le **TrainerSearchViewModel** qui est un **IPagniatedList&ltTrainer&gt** pour bien afficher les liens de navigations
2. Mettez le code pour que l‚Äôensemble des pages disponibles soient affich√©es dans la pagination.
3. Ajoutez la logique que **Previous** et **Next** fonctionnent et s'affichent lorsque n√©cessaire. 

![Image Reference](/tps/tp2/navigation.png)

4. Ajoutez le javascript en utilisant **jQuery** pour que la page change dans le filtre du formulaire et qu'il se soumette automatiquement lorsqu'on clique sur un √©l√©ment de pagination (incluant Previous et Next). Utilisez les attributs **data-page-id** qui sont d√©j√† l√† sur les √©l√©ments de navigation. Il y a plusieurs fa√ßon d'obtenir le m√™me r√©sultat, mais voici les grandes √©tapes n√©cesaires en JS :
   - Ex√©cuter une fonction JS lorsqu'un √©l√©ment de pagnination est cliqu√©.
   - Obtenir la valeur du **data-page-id** de l'√©l√©ment sur lequel l'utilisateur a cliqu√©.
   - Obtenir l'√©l√©ment qui contient l'information du **SeletectedPageIndex** (libre √† vous d'ajouter un Id pour vous aider √† l'obtenir plus facilement)
   ![Image Reference](/tps/tp2/SelectPageIndex.png)
   - Modifier la valeur de l'√©l√©ment en question
5. Une fois que votre navigation fonctionne bien, mettez le **SelectedPageIndex** (l'√©l√©ment mentionn√© dans le point pr√©c√©dent) en **type="hidden"** et supprimez le libell√© (label associ√©).

<CommentCommitPush/>

## G√©n√©rez les vues et contr√¥leur (RecordController) du mod√®le Record

:::warning

 Au moment de g√©n√©rez le contr√¥leur il faut le nommer **RecordController** et non pas **RecordsController** (Donc, pas de s!).
 C'est important car les liens existants et les fichiers de traduction utilisent tous Record et non pas Records!

:::

:::danger

Si vous avez une erreur, assurez-vous d'utiliser la derni√®re version de toutes les librarires dans votre projet 6.0.X (Pr√©sentement 6.0.24, sauf pour la librairie Microsoft.VisualStudio.Web.CodeGeneration.Design qui utilise 6.0.16)

:::

:::warning

La g√©n√©ration de contr√¥leur utilise parfois des @ dans son code et √ßa cause des erreurs! Vous pouvez simplement remplacer les @ par un nom de variable diff√©rent, comme x.

:::

:::warning

La g√©n√©ration de contr√¥leur utilisent des **[bind]** pour les actions **post** de **Create** et **Edit**. √Ä moins que vous soyez d√©j√† famili√© avec leur utilisation, vous pouvez **simplement les retirer**.

:::

1. G√©n√©rez un contr√¥leur MVC avec ses vues pour le mod√®le Record. (Un lien vers cette vue existe d√©j√† dans la barre de navigation)
2. Lorsqu‚Äôil y a un dropdown, au lieu de le mettre dans le ViewData ou le ViewBag, faites un ViewModel (**RecordViewModel**) (ou plusieurs) avec les SelectList et les informations du mod√®le.

:::warning

Il existe d√©j√† des fichiers .resx pour le view model **RecordViewModel**. Si vous utilisez un autre nom ou utiliez d'autres view models, il faudra s'assurer de faire fonctionner la traduction.

:::

3. Lorsque vous affichez **Trainer**:
   - Affichez le **nom complet** du **Trainer**
4. Lorsque vous affichez **Discipline** 
   - Affichez le **nom** de la **Discipline**
5. Faites un **service** pour g√©rer la cr√©ation de ViewModel et les interactions avec le DbContext (Une fois que vous avez termin√©, le contr√¥leur n'utilisera plus directement JulieProDBContext)
6. Utilisez le **service** dans le contr√¥leur 


<CommentCommitPush/>

## Ajoutez une vue pour voir les **Records** d'un **Trainer**
1. Ajoutez une action √† votre contr√¥leur qui permet de voir les **Records** d'un **Trainer** Record/TrainerIndex(int trainerId)
   - Il existe d√©j√† un ic√¥ne de troph√© sur la vue d√©taill√© du Trainer qui doit permettre d'afficher cette page
2. Ajoutez √©galement la vue n√©cessaire

![Image Reference](/tps/tp2/vueTrainerIndex.png)

<CommentCommitPush/>

## V√©rification de la traduction

1. Assurez-vous que vos **nouvelles** pages sont toutes bien traduites 
   - Les resx sont g√©n√©ralement d√©j√† l√†, utilisez-les
   - Il manque la traduction des messages d‚Äôerreur. Assurez-vous de faire la traduction pour les cas suivants:
      - Une valeur de **Amount invalide** (Out of Range)
      - Un champ **Unit manquant** (champ vide)
      - Vous pouvez en faire plus, mais ce ne sera pas √©valu√©. La traduction du message **"must be a number"** est assez complexe, alors ce n'est **pas** conseill√© d'essayer de le traduire!
      ![Image Reference](/tps/tp2/mustBeANumber.png)
   
<CommentCommitPush/>

## Injection du ILogger

1. Injectez le ILogger dans le contr√¥leur Record (Vue √† la s√©ance 9)
   - Affichez dans la console les logs de type erreur (Faites un log d'erreur pour au moins 1 erreur de vore contr√¥leur)
   
   ![Image Reference](/tps/tp2/logError.png)
   - Affichez dans la console les logs de type information pour la **cr√©ation** et **modification** de **Records** (inclure la date de la cr√©ation/modification)
   
   ![Image Reference](/tps/tp2/logInformation.png)

<CommentCommitPush/>

## BONUS
1. Ex√©cuter le filtre lorsqu‚Äôon change n‚Äôimporte quel param√®tre du filtre

:::danger

Une fois que vous avez termin√© votre TP, il est temps de merger votre branche **TP2** dans votre branche **Main**.

:::

## Grille de correction

| T√¢che | Nb Points |
| :--- | :----: |
| Terminer de mettre en place i18n | 2 |
| Faire fonctionner le filtre | 4 |
| Afficher le d√©tail d'un Trainer | 1 |
| Faire fonctionner la pagination | 4 |
| Ajouter RecordController | 5 |
| Ajouter une vue pour les records d'un entra√Æneur | 2 |
| ILogger | 1 |
| Traduire le contenu ajout√© | 1 |
| **Total** | ** /20 ** |
| Point bonus | 1 |

-->
